<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Remove Background</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body {
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: #333;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 480px;
      text-align: center;
    }

    input[type="file"] {
      margin: 15px 0;
    }

    button {
      background-color: #007bff;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }

    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    #previewImage, #resultImg {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 15px;
    }

    .download-buttons {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .download-buttons button {
      padding: 8px 14px;
      font-size: 14px;
    }

    .error {
      color: red;
      margin-top: 15px;
      font-weight: bold;
    }

    .processing {
      margin-top: 10px;
      color: #555;
      font-style: italic;
    }
  </style>
</head>
<body>

  <h1>Remove Background</h1>
  <div class="container">
    <input type="file" id="imageInput" accept="image/*" onchange="showPreview()">
    <div id="previewContainer">
      <img id="previewImage" style="display:none;">
    </div>
    <button onclick="removeBackground()" id="submitBtn">Remove Background</button>
    <div class="processing" id="processingText"></div>
    <div id="output"></div>
    <div class="error" id="errorMsg"></div>
  </div>

  <script>
    let selectedFile;

    function showPreview() {
      const fileInput = document.getElementById('imageInput');
      const previewImage = document.getElementById('previewImage');
      const errorMsg = document.getElementById('errorMsg');
      const output = document.getElementById('output');
      const processing = document.getElementById('processingText');

      errorMsg.textContent = '';
      output.innerHTML = '';
      processing.textContent = '';
      selectedFile = fileInput.files[0];

      if (selectedFile) {
        const imageUrl = URL.createObjectURL(selectedFile);
        previewImage.src = imageUrl;
        previewImage.style.display = 'block';
      } else {
        previewImage.style.display = 'none';
      }
    }

    async function removeBackground() {
      const previewImage = document.getElementById('previewImage');
      const button = document.getElementById('submitBtn');
      const output = document.getElementById('output');
      const errorMsg = document.getElementById('errorMsg');
      const processing = document.getElementById('processingText');

      if (!selectedFile) {
        alert("Please select an image.");
        return;
      }

      previewImage.style.display = 'none';
      button.disabled = true;
      errorMsg.textContent = '';
      processing.textContent = 'Processing...';

      const formData = new FormData();
      formData.append("image_file", selectedFile);
      formData.append("size", "auto");

      try {
        const response = await fetch("https://api.remove.bg/v1.0/removebg", {
          method: "POST",
          headers: {
            "X-Api-Key": "akFKbAUvBCaTcLVisqYg1CrC" // ✅ Your API Key added here
          },
          body: formData
        });

        if (!response.ok) throw new Error("Failed to remove background");

        const blob = await response.blob();
        const imgURL = URL.createObjectURL(blob);

        output.innerHTML = `
          <img src="${imgURL}" id="resultImg">
          <div class="download-buttons">
            <a href="${imgURL}" download="removed-bg.png">
              <button>Download PNG</button>
            </a>
            <a href="#" id="jpgDownload">
              <button>Download JPG</button>
            </a>
          </div>
        `;

        // JPG Download
        document.getElementById('jpgDownload').onclick = function (e) {
          e.preventDefault();
          const img = document.getElementById("resultImg");
          const canvas = document.createElement("canvas");
          canvas.width = img.naturalWidth;
          canvas.height = img.naturalHeight;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);
          const jpgURL = canvas.toDataURL("image/jpeg", 1.0);

          const a = document.createElement("a");
          a.href = jpgURL;
          a.download = "removed-bg.jpg";
          a.click();
        };

      } catch (err) {
        errorMsg.textContent = "❌ Failed to remove background. Please check your API key or try again.";
      } finally {
        button.disabled = false;
        processing.textContent = '';
      }
    }
  </script>

</body>
</html>